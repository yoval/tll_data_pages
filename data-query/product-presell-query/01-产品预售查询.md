### 产品预售查询

```sql
-- 创建一个包含订单信息的临时表
WITH OrderTable AS (
    SELECT DISTINCT  
        presale_order_num AS 预售单号,
				activity_id as 预售ID,
        order_time AS 订单时间,
        store_code AS 门店编号
    FROM flink_rps_tll_presale_order_df
),

DetailsTable AS (
    SELECT DISTINCT 
        presale_order_num AS 预售单号,
        product_info AS 产品名称,
        quantity AS 数量
    FROM flink_rps_tll_presale_order_details_df
),
SummaryTable AS (
    -- 主查询，选择所需字段并进行联接
    SELECT 
        ot.门店编号,  
        ot.预售单号, 
        ot.订单时间, 
        ot.预售ID, 
        dt.产品名称,  
        dt.数量
    FROM 
        OrderTable ot      
    LEFT JOIN 
        DetailsTable dt     
    ON 
        ot.预售单号 = dt.预售单号 
)

SELECT * FROM SummaryTable
WHERE 预售ID in ('1840337065095979010')
ORDER BY 订单时间 DESC
```

查询结果：

| 门店编号 | 预售单号       | 订单时间            | 预售ID              | 产品名称                 | 数量 |
| -------- | -------------- | ------------------- | ------------------- | ------------------------ | ---- |
| TLL06933 | YS101490261366 | 2024-10-14 09:56:56 | 1840337065095979010 | 糯米麻薯粉(风味固体饮料) | 0    |
| TLL06933 | YS101490261366 | 2024-10-14 09:56:56 | 1840337065095979010 | 炖梨套餐                 | 0    |
| TLL06933 | YS101490261366 | 2024-10-14 09:56:56 | 1840337065095979010 | 鸡蛋布蕾粉(风味固体饮料) | 0    |
| TLL07601 | YS101482974533 | 2024-10-14 09:54:39 | 1840337065095979010 | 糯米麻薯粉(风味固体饮料) | 1    |
| TLL07601 | YS101482974533 | 2024-10-14 09:54:39 | 1840337065095979010 | 炖梨套餐                 | 3    |
| TLL07601 | YS101482974533 | 2024-10-14 09:54:39 | 1840337065095979010 | 鸡蛋布蕾粉(风味固体饮料) | 1    |
| TLL05804 | YS101433738480 | 2024-10-14 09:54:17 | 1840337065095979010 | 炖梨套餐                 | 0    |
| TLL05804 | YS101433738480 | 2024-10-14 09:54:17 | 1840337065095979010 | 糯米麻薯粉(风味固体饮料) | 0    |
| TLL05804 | YS101433738480 | 2024-10-14 09:54:17 | 1840337065095979010 | 鸡蛋布蕾粉(风味固体饮料) | 0    |
| TLL06700 | YS101445878015 | 2024-10-14 09:53:31 | 1840337065095979010 | 糯米麻薯粉(风味固体饮料) | 0    |

